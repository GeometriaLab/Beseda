var JSON;JSON||(JSON={});
(function(){function a(a){return a<10?"0"+a:a}function b(a){e.lastIndex=0;return e.test(a)?'"'+a.replace(e,function(a){var b=o[a];return typeof b==="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(a,d){var e,k,i,l,m=g,h,f=d[a];f&&typeof f==="object"&&typeof f.toJSON==="function"&&(f=f.toJSON(a));typeof j==="function"&&(f=j.call(d,a,f));switch(typeof f){case "string":return b(f);case "number":return isFinite(f)?String(f):"null";case "boolean":case "null":return String(f);case "object":if(!f)return"null";
g+=n;h=[];if(Object.prototype.toString.apply(f)==="[object Array]"){l=f.length;for(e=0;e<l;e+=1)h[e]=c(e,f)||"null";i=h.length===0?"[]":g?"[\n"+g+h.join(",\n"+g)+"\n"+m+"]":"["+h.join(",")+"]";g=m;return i}if(j&&typeof j==="object"){l=j.length;for(e=0;e<l;e+=1)typeof j[e]==="string"&&(k=j[e],(i=c(k,f))&&h.push(b(k)+(g?": ":":")+i))}else for(k in f)Object.prototype.hasOwnProperty.call(f,k)&&(i=c(k,f))&&h.push(b(k)+(g?": ":":")+i);i=h.length===0?"{}":g?"{\n"+g+h.join(",\n"+g)+"\n"+m+"}":"{"+h.join(",")+
"}";g=m;return i}}if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":"null"},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,n,o={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},j;if(typeof JSON.stringify!=="function")JSON.stringify=function(a,b,d){var e;n=g="";if(typeof d==="number")for(e=0;e<d;e+=1)n+=" ";else typeof d==="string"&&(n=d);if((j=b)&&typeof b!=="function"&&(typeof b!=="object"||typeof b.length!=="number"))throw Error("JSON.stringify");return c("",
{"":a})};if(typeof JSON.parse!=="function")JSON.parse=function(a,b){function c(a,d){var e,g,f=a[d];if(f&&typeof f==="object")for(e in f)Object.prototype.hasOwnProperty.call(f,e)&&(g=c(f,e),g!==void 0?f[e]=g:delete f[e]);return b.call(a,d,f)}var e,a=String(a);d.lastIndex=0;d.test(a)&&(a=a.replace(d,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return e=eval("("+a+")"),typeof b==="function"?c({"":e},""):e;throw new SyntaxError("JSON.parse");}})();var BesedaPackage={utils:{},events:{},transport:{}};BesedaPackage.transport.request={};BesedaPackage.events.EventEmitter=function(){};BesedaPackage.events.EventEmitter.defaultMaxListeners=10;BesedaPackage.events.EventEmitter.isArray=Array.isArray||function(a){return Object.prototype.toString.call(a)=="[object Array]"};
BesedaPackage.events.EventEmitter.prototype.setMaxListeners=function(a){if(!this._events)this._events={};this._events.maxListeners=a};
BesedaPackage.events.EventEmitter.prototype.emit=function(a){if(a==="error"&&(!this._events||!this._events.error||BesedaPackage.events.EventEmitter.isArray(this._events.error)&&!this._events.error.length))if(arguments[1]instanceof Error)throw arguments[1];else throw Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var b=this._events[a];if(!b)return!1;if(typeof b=="function"){switch(arguments.length){case 1:b.call(this);break;case 2:b.call(this,arguments[1]);break;case 3:b.call(this,
arguments[1],arguments[2]);break;default:var c=Array.prototype.slice.call(arguments,1);b.apply(this,c)}return!0}else if(BesedaPackage.events.EventEmitter.isArray(b)){for(var c=Array.prototype.slice.call(arguments,1),b=b.slice(),d=0,e=b.length;d<e;d++)b[d].apply(this,c);return!0}else return!1};
BesedaPackage.events.EventEmitter.prototype.addListener=function(a,b){if("function"!==typeof b)throw Error("addListener only takes instances of Function");if(!this._events)this._events={};this.emit("newListener",a,b);if(this._events[a])if(BesedaPackage.events.EventEmitter.isArray(this._events[a])){if(this._events[a].push(b),!this._events[a].warned){var c;if((c=this._events.maxListeners!==void 0?this._events.maxListeners:BesedaPackage.events.EventEmitter.defaultMaxListeners)&&c>0&&this._events[a].length>
c)this._events[a].warned=!0,alert("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit. "+this._events[a].length)}}else this._events[a]=[this._events[a],b];else this._events[a]=b;return this};BesedaPackage.events.EventEmitter.prototype.on=BesedaPackage.events.EventEmitter.prototype.addListener;
BesedaPackage.events.EventEmitter.prototype.once=function(a,b){function c(){d.removeListener(a,c);b.apply(this,arguments)}if("function"!==typeof b)throw Error(".once only takes instances of Function");var d=this;c.listener=b;d.on(a,c);return this};
BesedaPackage.events.EventEmitter.prototype.removeListener=function(a,b){if("function"!==typeof b)throw Error("removeListener only takes instances of Function");if(!this._events||!this._events[a])return this;var c=this._events[a];if(BesedaPackage.events.EventEmitter.isArray(c)){for(var d=-1,e=0,g=c.length;e<g;e++)if(c[e]===b||c[e].listener&&c[e].listener===b){d=e;break}if(d<0)return this;c.splice(d,1);c.length==0&&delete this._events[a]}else(c===b||c.listener&&c.listener===b)&&delete this._events[a];
return this};BesedaPackage.events.EventEmitter.prototype.removeAllListeners=function(a){if(arguments.length===0)return this._events={},this;a&&this._events&&this._events[a]&&(this._events[a]=null);return this};BesedaPackage.events.EventEmitter.prototype.listeners=function(a){if(!this._events)this._events={};this._events[a]||(this._events[a]=[]);BesedaPackage.events.EventEmitter.isArray(this._events[a])||(this._events[a]=[this._events[a]]);return this._events[a]};
BesedaPackage.utils.cloneObject=function(a){return BesedaPackage.utils.mergeObjects({},a)};BesedaPackage.utils.mergeObjects=function(a,b){for(var c in b)try{a[c]=b[c].constructor==Object?BesedaPackage.utils.mergeObjects(a[c],b[c]):b[c]}catch(d){a[c]=b[c]}return a};BesedaPackage.utils.inherits=function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a};BesedaPackage.utils.log=function(a){window.console&&window.console.log(a)};
BesedaPackage.utils.__base64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split("");BesedaPackage.utils.__base64charsLength=BesedaPackage.utils.__base64chars.length;BesedaPackage.utils.uid=function(a){for(var a=a||10,b=0,c=[];b<a;b++)c[b]=BesedaPackage.utils.__base64chars[0|Math.random()*BesedaPackage.utils.__base64charsLength];return c.join("")};
BesedaPackage.Client=function(a){BesedaPackage.events.EventEmitter.prototype.constructor.call(this);this.__options=BesedaPackage.utils.mergeObjects({host:document.location.hostname,port:4E3,ssl:!1,transports:["webSocket","longPolling","JSONPLongPolling"],reconnect:!0,reconnectDelay:1E3,reconnectMaxAttempts:20},a);this.router=new BesedaPackage.Router(this);this.clientId=null;this._io=new BesedaPackage.IO(this.__options);this.__status=BesedaPackage.Client.__statuses.DISCONNECTED;this.__messageQueue=
[];this.__channels=[];this.__reconnectTimeout=this.__connectionRequestMessage=null;this.__reconnectAttemptsCount=0;var b=this;this._io.addListener("message",function(a){b.router.dispatch(a)});this._io.addListener("error",function(){b.__destroy();b.__options.reconnect&&b.__reconnect()});this.__handleConnectionClosure=function(a){b.clientId=a;b.__resetReconnection();a=b.__createMessage("/meta/connect",b.__connectionRequestMessage);b._io.send(a)}};BesedaPackage.utils.inherits(BesedaPackage.Client,BesedaPackage.events.EventEmitter);
BesedaPackage.Client.__statuses={DISCONNECTED:0,CONNECTING:1,CONNECTED:2};BesedaPackage.Client.prototype.isConnected=function(){return this.__status==BesedaPackage.Client.__statuses.CONNECTED};BesedaPackage.Client.prototype.isDisconnected=function(){return this.__status==BesedaPackage.Client.__statuses.DISCONNECTED};BesedaPackage.Client.prototype.isConnecting=function(){return this.__status==BesedaPackage.Client.__statuses.CONNECTING};
BesedaPackage.Client.prototype.isReconnecting=function(){return this.__reconnectTimeout!==null};BesedaPackage.Client.prototype.subscribe=function(a,b,c){this.isDisconnected()&&this.connect();var d=c||{};d.subscription=a;var d=this.__sendMessage("/meta/subscribe",d),e=this;this.once("subscribe:"+d.id,function(b){b||(e.__channels[a]=d)});if(b)this.once("subscribe:"+d.id,b)};
BesedaPackage.Client.prototype.unsubscribe=function(a,b,c){this.isDisconnected()&&this.connect();c=c||{};c.subscription=a;var c=this.__sendMessage("/meta/unsubscribe",c),d=this;this.once("unsubscribe:"+c.id,function(b){b||delete d.__channels[a]});if(b)this.once("unsubscribe:"+c.id,b)};BesedaPackage.Client.prototype.publish=function(a,b,c){this.isDisconnected()&&this.connect();b=this.__sendMessage(a,{data:b});if(c)this.once("publish:"+b.id,c)};
BesedaPackage.Client.prototype.connect=function(a,b,c,d){if(!this.isConnected()||!this.isConnecting()){this.isReconnecting()&&this.__resetReconnection();this.__status=BesedaPackage.Client.__statuses.CONNECTING;if(d!==void 0)this.__connectionRequestMessage=d;if(!this._io.listeners("connect").length)this._io.on("connect",this.__handleConnectionClosure);this._io.connect(a,b,c);for(var e in this.__channels)this.__sendMessage("/meta/subscribe",this.__channels[e])}};
BesedaPackage.Client.prototype.disconnect=function(){this._io.disconnect();this.__channels=[];this.__destroy();this.__resetReconnection();this.emit("disconnect")};BesedaPackage.Client.prototype.applyConnection=function(){this.__status=BesedaPackage.Client.__statuses.CONNECTED;this.__flushMessageQueue()};BesedaPackage.Client.prototype.setConnectionMessage=function(a){this.__connectionRequestMessage=a};
BesedaPackage.Client.prototype.__reconnect=function(){if(this.isReconnecting())return!1;if(this.__options.reconnectMaxAttempts>this.__reconnectAttemptsCount){this.__reconnectAttemptsCount++;var a=this,b=this.__options.reconnectDelay*this.__reconnectAttemptsCount;this.emit("reconnecting",this.__reconnectAttemptsCount,b);this.__reconnectTimeout=setTimeout(function(){a.__reconnectTimeout=null;a.connect()},b)}else this.__reconnectAttemptsCount=0,this.emit("reconnectError")};
BesedaPackage.Client.prototype.__resetReconnection=function(){this.__reconnectAttemptsCount=0;clearTimeout(this.__reconnectTimeout);this.__reconnectTimeout=null};BesedaPackage.Client.prototype.__destroy=function(){this.__status=BesedaPackage.Client.__statuses.DISCONNECTED;this.clientId=null;this.__messageQueue=[]};
BesedaPackage.Client.prototype.__sendMessage=function(a,b){if(!this.isDisconnected())return b=this.__createMessage(a,b),this.isConnecting()?this.__messageQueue.push(b):this._io.send(b),b};BesedaPackage.Client.prototype.__createMessage=function(a,b){b=b||{};b.id=BesedaPackage.utils.uid();b.channel=a;b.clientId=this.clientId;return b};
BesedaPackage.Client.prototype.__flushMessageQueue=function(){for(var a=0;a<this.__messageQueue.length;a++)this.__messageQueue[a].clientId=this.clientId;this._io.send(this.__messageQueue);this.__messageQueue=[]};var Beseda=BesedaPackage.Client;BesedaPackage.Router=function(a){this.__client=a};
BesedaPackage.Router.prototype.dispatch=function(a){if(a.channel==void 0||a.clientId==void 0||a.id==void 0)this.__client.emit("error","Beseda receive incorrect message",a);else if(a.channel.indexOf("/meta/")==0){var b=a.channel.substr(6);!b in["connect","error","subscribe","unsubscribe"]?this.__client.emit("error","Unsupported meta channel "+a.channel,a):this["_"+b].call(this,a)}else"successful"in a?this._publish(a):this._message(a)};
BesedaPackage.Router.prototype._connect=function(a){a.successful?(this.__client.applyConnection(),this.__client.emit("connect",a)):(this.__client.disconnect(),this.__client.emit("error","Beseda connection request declined",a))};BesedaPackage.Router.prototype._error=function(a){this.__client.emit("error",a.data,a)};
BesedaPackage.Router.prototype._subscribe=function(a){a.successful||this.__client.emit("error",a.error,a);this.__client.emit("subscribe",a.error,a);this.__client.emit("subscribe:"+a.id,a.error,a)};BesedaPackage.Router.prototype._unsubscribe=function(a){a.successful||this.__client.emit("error",a.error,a);this.__client.emit("unsubscribe",a.error,a);this.__client.emit("unsubscribe:"+a.id,a.error,a)};
BesedaPackage.Router.prototype._publish=function(a){a.successful||this.__client.emit("error",a.error,a);this.__client.emit("publish:"+a.id,a.error,a);this.__client.emit("publish",a.error,a)};BesedaPackage.Router.prototype._message=function(a){this.__client.emit("message:"+a.channel,a.data,a);this.__client.emit("message",a.channel,a.data,a)};
BesedaPackage.IO=function(a){BesedaPackage.events.EventEmitter.prototype.constructor.call(this);this.__options=a;this.__transport=BesedaPackage.Transport.getBestTransport(a);this.__transport.setEmitter(this)};BesedaPackage.utils.inherits(BesedaPackage.IO,BesedaPackage.events.EventEmitter);
BesedaPackage.IO.prototype.connect=function(a,b,c){if(a!==void 0)this.__options.host=a;if(b!==void 0)this.__options.port=b;if(c!==void 0)this.__options.ssl=c;this.__transport.connect(this.__options.host,this.__options.port,this.__options.ssl)};BesedaPackage.IO.prototype.send=function(a){this.__transport.send([].concat(a))};BesedaPackage.IO.prototype.disconnect=function(){this.__transport.disconnect()};
BesedaPackage.Transport=function(a){this._isXDomain=a;this._emitter=this._connectionID=this._typeSuffix=this._url=null;this._isConnected=!1;this._typeSuffix=null;this.__sendQueue=[];this.__pendingMessages={}};BesedaPackage.Transport.__transports={longPolling:"LongPolling",JSONPLongPolling:"JSONPLongPolling",webSocket:"WebSocket"};
BesedaPackage.Transport.getBestTransport=function(a){for(var b,c=document.location.hostname!=a.host||(document.location.port||(a.ssl?443:80))!=a.port,d=0;d<a.transports.length;d++){switch(a.transports[d]){case "longPolling":b=BesedaPackage.transport.LongPolling;break;case "JSONPLongPolling":b=BesedaPackage.transport.JSONPLongPolling;break;case "webSocket":b=BesedaPackage.transport.WebSocket;break;default:throw Error("Ivalid transport "+a.transports[d]);}if(b.isAvailable(a,c))break}return new b(c)};
BesedaPackage.Transport.prototype.connect=function(){throw Error("Abstract method calling.");};BesedaPackage.Transport.prototype.send=function(a){if(this._isConnected){for(var b=a.length-1;b>=0;)this.__pendingMessages[a[b].id]=!0,b--;this._doSend(JSON.stringify(a))}else this._enqueue(a)};BesedaPackage.Transport.prototype._doSend=function(){throw Error("Abstract method calling.");};BesedaPackage.Transport.prototype.disconnect=function(){throw Error("Abstract method calling.");};
BesedaPackage.Transport.prototype.setEmitter=function(a){this._emitter=a};BesedaPackage.Transport.prototype._handleConnection=function(a){this._connectionID=a;for(this._emitter&&this._emitter.emit("connect",this._connectionID);this.__sendQueue.length;)this.send(this.__sendQueue.shift())};BesedaPackage.Transport.prototype._handleMessages=function(a){for(var b;a&&a.length;)b=a.shift(),this._emitter.emit("message",b),delete this.__pendingMessages[b.id]};
BesedaPackage.Transport.prototype._handleError=function(a){var b=[],c;for(c in this.__pendingMessages)b.push(this.__pendingMessages[c]),this._emitter.emit("message:"+c,a);b.length&&this._enqueue(b);this._emitter.emit("error");this.__pendingMessages={}};BesedaPackage.Transport.prototype._decodeData=function(a){return JSON.parse(a)};BesedaPackage.Transport.prototype._enqueue=function(a){this.__sendQueue.push(a)};
BesedaPackage.transport.LongPolling=function(a){BesedaPackage.Transport.prototype.constructor.call(this,a);this._typeSuffix="longPolling";this.__handleCloseClosure=this.__handleDataClosure=this.__handleOpenClosure=this._closeRequest=this._sendRequest=this._dataRequest=this._openRequest=this._url=null;this.__initClosuredHandlers();this._initRequests();this._initListeners()};BesedaPackage.utils.inherits(BesedaPackage.transport.LongPolling,BesedaPackage.Transport);
BesedaPackage.transport.LongPolling.isAvailable=function(a,b){return!!BesedaPackage.transport.request.XHRRequest.createRequest(b)};BesedaPackage.transport.LongPolling.prototype.__initClosuredHandlers=function(){var a=this;this.__handleOpenClosure=function(b){a._handleOpen(b)};this.__handleDataClosure=function(b){a._handleData(b)};this.__handleCloseClosure=function(b){a._handleError(b)}};
BesedaPackage.transport.LongPolling.prototype._initRequests=function(){this._openRequest=new BesedaPackage.transport.request.XHRRequest("GET",this._isXDomain);this._dataRequest=new BesedaPackage.transport.request.XHRRequest("GET",this._isXDomain);this._sendRequest=new BesedaPackage.transport.request.XHRRequest("PUT",this._isXDomain);this._closeRequest=new BesedaPackage.transport.request.XHRRequest("DELETE",this._isXDomain)};
BesedaPackage.transport.LongPolling.prototype._initListeners=function(){this._openRequest.addListener("ready",this.__handleOpenClosure);this._openRequest.addListener("error",this.__handleCloseClosure);this._dataRequest.addListener("ready",this.__handleDataClosure);this._dataRequest.addListener("error",this.__handleCloseClosure)};
BesedaPackage.transport.LongPolling.prototype._initURLs=function(a){this._sendRequest.url=this._dataRequest.url=this._closeRequest.url=this._url+"/"+this._typeSuffix+"/"+a};BesedaPackage.transport.LongPolling.prototype.connect=function(a,b,c){this._url="http"+(c?"s":"")+"://"+a+(b?":"+b:"")+"/beseda/io";this._openRequest.send(this._url+"/"+this._typeSuffix)};
BesedaPackage.transport.LongPolling.prototype._handleOpen=function(a){a=this._decodeData(a);this._isConnected=!0;this._initURLs(a.connectionId);BesedaPackage.Transport.prototype._handleConnection.call(this,a.connectionId);this.__poll()};BesedaPackage.transport.LongPolling.prototype._doSend=function(a){this._sendRequest.data=a;this._sendRequest.send()};BesedaPackage.transport.LongPolling.prototype.disconnect=function(){this._closeRequest.send();this._isConnected=!1};
BesedaPackage.transport.LongPolling.prototype._handleData=function(a){BesedaPackage.Transport.prototype._handleMessages.call(this,this._decodeData(a));this.__poll()};BesedaPackage.transport.LongPolling.prototype.__poll=function(){this._isConnected&&this._dataRequest.send()};BesedaPackage.transport.JSONPLongPolling=function(a){BesedaPackage.transport.LongPolling.prototype.constructor.call(this,a);this._typeSuffix="JSONPLongPolling"};
BesedaPackage.utils.inherits(BesedaPackage.transport.JSONPLongPolling,BesedaPackage.transport.LongPolling);BesedaPackage.transport.JSONPLongPolling.isAvailable=function(){return!0};BesedaPackage.transport.JSONPLongPolling.prototype._initRequests=function(){this._openRequest=new BesedaPackage.transport.request.JSONPRequest;this._dataRequest=new BesedaPackage.transport.request.JSONPRequest;this._sendRequest=new BesedaPackage.transport.request.JSONPRequest;this._closeRequest=new BesedaPackage.transport.request.JSONPRequest};
BesedaPackage.transport.JSONPLongPolling.prototype._initURLs=function(a){BesedaPackage.transport.LongPolling.prototype._initURLs.call(this,a);this._sendRequest.url+="/send";this._closeRequest.url+="/destroy"};BesedaPackage.transport.JSONPLongPolling.prototype._decodeData=function(a){return a};
BesedaPackage.transport.WebSocket=function(a){BesedaPackage.Transport.prototype.constructor.call(this,a);this._typeSuffix="webSocket";this.__handleCloseClosure=this.__handleDataClosure=this.__handleOpenClosure=this.__ws=null;this.__initClosuredHandlers()};BesedaPackage.utils.inherits(BesedaPackage.transport.WebSocket,BesedaPackage.Transport);BesedaPackage.transport.WebSocket.isAvailable=function(){return window.MozWebSocket||window.WebSocket&&!WebSocket.__addTask};
BesedaPackage.transport.WebSocket.prototype.__initClosuredHandlers=function(){var a=this;this.__handleOpenClosure=function(b){a.__handleOpen(b)};this.__handleDataClosure=function(b){a.__handleData(b)};this.__handleCloseClosure=function(b){a.__handleClose(b)}};
BesedaPackage.transport.WebSocket.prototype.connect=function(a,b,c){if(!this._isConnected)this.__ws=new (window.MozWebSocket||window.WebSocket)("ws"+(c?"s":"")+"://"+a+(b?":"+b:"")+"/beseda/io/"+this._typeSuffix+"/"+(new Date).getTime()),this.__ws.addEventListener("open",this.__handleOpenClosure,!1),this.__ws.addEventListener("message",this.__handleDataClosure,!1),this.__ws.addEventListener("error",this.__handleCloseClosure,!1),this.__ws.addEventListener("close",this.__handleCloseClosure,!1)};
BesedaPackage.transport.WebSocket.prototype.disconnect=function(){this.__ws.close();this._isConnected=this.__handshaked=!1};BesedaPackage.transport.WebSocket.prototype._doSend=function(a){this.__ws.send(a)};BesedaPackage.transport.WebSocket.prototype.__handleOpen=function(){this._isConnected=!0};
BesedaPackage.transport.WebSocket.prototype.__handleData=function(a){a=this._decodeData(a.data);this.__handshaked?BesedaPackage.Transport.prototype._handleMessages.call(this,a):(this.__handshaked=!0,BesedaPackage.Transport.prototype._handleConnection.call(this,a.connectionId))};BesedaPackage.transport.WebSocket.prototype.__handleClose=function(a){this._isConnected&&(this._handleError(a),this.disconnect())};
BesedaPackage.transport.request.XHRRequest=function(a,b){BesedaPackage.events.EventEmitter.prototype.constructor.call(this);this._isXDomain=b;this.url=null;this.method=a;this.data=null};
BesedaPackage.transport.request.XHRRequest.createRequest=function(a){var b=null;window.XMLHttpRequest&&(!a||(new XMLHttpRequest).withCredentials!=void 0)?b=new XMLHttpRequest:window.XDomainRequest&&a?(b=new XDomainRequest,b.onprocess=function(){}):window.ActiveXObject&&!a&&(b=new ActiveXObject("Microsoft.XMLHTTP"));return b};BesedaPackage.utils.inherits(BesedaPackage.transport.request.XHRRequest,BesedaPackage.events.EventEmitter);
BesedaPackage.transport.request.XHRRequest.prototype.send=function(a){if(a)this.url=a;var a=this.url+"/"+(new Date).getTime(),b=BesedaPackage.transport.request.XHRRequest.createRequest(this._isXDomain),c=this;b.onreadystatechange=function(){c.__requestStateHandler(b)};this.method==="GET"&&this.data&&(a+=(a.indexOf("?")===-1?"?":"&")+this.data);b.open(this.method,encodeURI(a),!0);a=null;if(this.method!=="GET")a=this.data,b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.send(a)};
BesedaPackage.transport.request.XHRRequest.prototype.__requestStateHandler=function(a){a.readyState===4&&(a.status===200?this.emit("ready",a.responseText):this.emit("error"),a.abort())};BesedaPackage.transport.request.JSONPRequest=function(){BesedaPackage.events.EventEmitter.prototype.constructor.call(this);this.data=this.url=null;this.__id=++BesedaPackage.transport.request.JSONPRequest.__lastID;this.__requestIndex=0};BesedaPackage.utils.inherits(BesedaPackage.transport.request.JSONPRequest,BesedaPackage.events.EventEmitter);
BesedaPackage.transport.request.JSONPRequest.__callbacks={};BesedaPackage.transport.request.JSONPRequest.__lastID=0;BesedaPackage.transport.request.JSONPRequest.ERROR_TIMEOUT=15E3;
BesedaPackage.transport.request.JSONPRequest.prototype.send=function(a){if(a)this.url=a;var b=document.createElement("script");b.id="request_"+this.__id+"_"+this.__requestIndex;a=this.url+"/"+(new Date).getTime()+'?callback=BesedaPackage.transport.request.JSONPRequest.__callbacks["'+b.id+'"]';this.data!==null&&(a+="&messages="+this.data);b.src=a;var c=this,d=setTimeout(function(){clearTimeout(d);document.body.removeChild(b);delete BesedaPackage.transport.request.JSONPRequest.__callbacks[b.id];c.emit("error")},
BesedaPackage.transport.request.JSONPRequest.ERROR_TIMEOUT);BesedaPackage.transport.request.JSONPRequest.__callbacks[b.id]=function(a){clearTimeout(d);document.body.removeChild(b);delete BesedaPackage.transport.request.JSONPRequest.__callbacks[b.id];c.emit("ready",a)};document.body.appendChild(b);this.__requestIndex++;this.data=null};
